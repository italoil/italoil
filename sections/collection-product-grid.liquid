<section class="section">
  <div class="container">
    {%- if collection.products_count > 0 -%}
      <div class="grid grid--3-col">
        {%- for product in collection.products -%}
          <div class="product-card">
            <div class="product-card__image-wrapper">
              <a href="{{ product.url }}">
                {%- if product.featured_image -%}
                  <img 
                    src="{{ product.featured_image | image_url: width: 600 }}"
                    alt="{{ product.featured_image.alt | escape }}"
                    class="product-card__image"
                    loading="lazy"
                  >
                {%- else -%}
                  {{ 'product-1' | placeholder_svg_tag: 'product-card__image' }}
                {%- endif -%}
              </a>

              {%- if product.compare_at_price > product.price -%}
                <span class="product-card__badge">Sale</span>
              {%- elsif product.available == false -%}
                <span class="product-card__badge">Sold Out</span>
              {%- elsif product.tags contains 'new' -%}
                <span class="product-card__badge">New</span>
              {%- elsif product.tags contains 'dop' -%}
                <span class="product-card__badge">DOP</span>
              {%- endif -%}
            </div>

            <div class="product-card__content">
              <h3 class="product-card__title">
                <a href="{{ product.url }}">{{ product.title }}</a>
              </h3>

              {%- if product.description != blank -%}
                <p class="product-card__description">
                  {{ product.description | strip_html | truncatewords: 15 }}
                </p>
              {%- endif -%}

              <div class="product-card__price">
                {%- if product.compare_at_price > product.price -%}
                  <span style="text-decoration: line-through; opacity: 0.6; margin-right: 1rem;">
                    {{ product.compare_at_price | money }}
                  </span>
                {%- endif -%}
                {{ product.price | money }}
              </div>

              <a href="{{ product.url }}" class="button button--full">
                {%- if product.available -%}
                  View Product
                {%- else -%}
                  Sold Out
                {%- endif -%}
              </a>
            </div>
          </div>
        {%- endfor -%}
      </div>

      {%- if paginate.pages > 1 -%}
        <div style="text-align: center; margin-top: 4rem;">
          {%- render 'pagination', paginate: paginate -%}
        </div>
      {%- endif -%}
    {%- else -%}
      <div style="text-align: center; padding: 6rem 2rem;">
        <h2>No products found</h2>
        <p style="margin-top: 1rem;">
          <a href="{{ routes.all_products_collection_url }}" class="button">Browse all products</a>
        </p>
      </div>
    {%- endif -%}
  </div>
</section>

{% schema %}
{
  "name": "Collection Product Grid",
  "tag": "section"
}
{% endschema %}
