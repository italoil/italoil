<section class="section">
  <div class="container">
    {%- if section.settings.title != blank -%}
      <h2 style="text-align: center; margin-bottom: 4rem;">{{ section.settings.title }}</h2>
    {%- endif -%}

    {%- if section.settings.collection != blank -%}
      {%- assign collection = collections[section.settings.collection] -%}
      
      <div class="grid grid--3-col">
        {%- for product in collection.products limit: section.settings.products_to_show -%}
          <div class="product-card">
            <div class="product-card__image-wrapper">
              <a href="{{ product.url }}">
                {%- if product.featured_image -%}
                  <img 
                    src="{{ product.featured_image | image_url: width: 600 }}"
                    srcset="{{ product.featured_image | image_url: width: 300 }} 300w,
                            {{ product.featured_image | image_url: width: 600 }} 600w"
                    sizes="(min-width: 1024px) 33vw, (min-width: 768px) 50vw, 100vw"
                    alt="{{ product.featured_image.alt | escape }}"
                    class="product-card__image"
                    loading="lazy"
                  >
                {%- else -%}
                  {{ 'product-1' | placeholder_svg_tag: 'product-card__image' }}
                {%- endif -%}
              </a>
              
              {%- if product.compare_at_price > product.price -%}
                <span class="product-card__badge">Sale</span>
              {%- elsif product.available == false -%}
                <span class="product-card__badge">Sold Out</span>
              {%- elsif product.tags contains 'new' -%}
                <span class="product-card__badge">New</span>
              {%- elsif product.tags contains 'dop' -%}
                <span class="product-card__badge">DOP</span>
              {%- endif -%}
            </div>

            <div class="product-card__content">
              <h3 class="product-card__title">
                <a href="{{ product.url }}">{{ product.title }}</a>
              </h3>

              {%- if product.description != blank -%}
                <p class="product-card__description">
                  {{ product.description | strip_html | truncatewords: 15 }}
                </p>
              {%- endif -%}

              <div class="product-card__price">
                {%- if product.compare_at_price > product.price -%}
                  <span style="text-decoration: line-through; opacity: 0.6; margin-right: 1rem;">
                    {{ product.compare_at_price | money }}
                  </span>
                {%- endif -%}
                {{ product.price | money }}
              </div>

              <a href="{{ product.url }}" class="button button--full">
                {%- if product.available -%}
                  View Product
                {%- else -%}
                  Sold Out
                {%- endif -%}
              </a>
            </div>
          </div>
        {%- endfor -%}
      </div>

      {%- if section.settings.show_view_all -%}
        <div style="text-align: center; margin-top: 4rem;">
          <a href="{{ collection.url }}" class="button">
            View All Products
          </a>
        </div>
      {%- endif -%}
    {%- endif -%}
  </div>
</section>

{% schema %}
{
  "name": "Featured Products",
  "tag": "section",
  "class": "featured-products-section",
  "settings": [
    {
      "type": "text",
      "id": "title",
      "label": "Heading",
      "default": "Our Olive Oils"
    },
    {
      "type": "collection",
      "id": "collection",
      "label": "Collection"
    },
    {
      "type": "range",
      "id": "products_to_show",
      "min": 2,
      "max": 12,
      "step": 1,
      "label": "Products to Show",
      "default": 3
    },
    {
      "type": "checkbox",
      "id": "show_view_all",
      "label": "Show 'View All' button",
      "default": true
    }
  ],
  "presets": [
    {
      "name": "Featured Products"
    }
  ]
}
{% endschema %}
